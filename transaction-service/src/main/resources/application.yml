spring:
  application:
    name: transaction-service
  cloud:
    config:
      uri: ${SPRING_CLOUD_CONFIG_URI}
  jpa:
    hibernate:
      ddl-auto: validate # Flyway manages schema, Hibernate only validates
    show-sql: true
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.PostgreSQLDialect
  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration
    baseline-version: 0
    repair-on-migrate: true

  rabbitmq:
    # host: host.docker.internal
    host: localhost
    port: 5672
    username: guest
    password: guest
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      timeout: 60000

# JWT Configuration
jwt:
  issuer-uri: ${JWT_ISSUER_URI:http://localhost:8888/realms/fortressbank-realm}

# Service Communication Configuration
services:
  account-service:
    url: ${ACCOUNT_SERVICE_URL:http://account-service:4001}
    timeout: 5000 # 5 seconds timeout for sync calls

eureka:
  client:
    serviceUrl:
      defaultZone: http://discovery:8761/eureka

# Stripe Configuration
stripe:
  api-key: ${STRIPE_SECRET_KEY}
  webhook-secret: ${STRIPE_WEBHOOK_SECRET}
  connect-account-id: ${STRIPE_CONNECT_ACCOUNT_ID}
  payout:
    timeout-seconds: 30
    currency: ${STRIPE_CURRENCY:usd}
    retry:
      max-attempts: 3
      backoff-delay-ms: 2000

# Resilience4j Configuration
resilience4j:
  retry:
    instances:
      stripePayout:
        maxAttempts: 3
        waitDuration: 2s
        exponentialBackoffMultiplier: 2
        retryExceptions:
          - com.stripe.exception.StripeException
  circuitbreaker:
    instances:
      stripePayout:
        slidingWindowSize: 10
        minimumNumberOfCalls: 5
        failureRateThreshold: 50
        waitDurationInOpenState: 30s
